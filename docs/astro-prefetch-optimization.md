# Astro 프리페칭 최적화 여정

블로그를 운영하면서 사용자들이 페이지를 클릭할 때마다 로딩 시간을 기다리는 모습을 보며, 더 부드러운 경험을 제공하고 싶다는 생각이 들었다. 그래서 Astro의 프리페칭 기능을 도입해보기로 했다.

## 프리페칭이 무엇인지 알아보며

프리페칭은 사용자가 실제로 클릭하기 전에 페이지를 미리 로드해두는 기술이다. 마치 친구가 집에 놀러 오기 전에 미리 간식을 준비해두는 것처럼, 사용자가 다음에 볼 만한 페이지를 예상해서 미리 불러와두는 것이다.

Astro에서는 정말 간단하게 설정할 수 있다. `astro.config.mjs` 파일에 `prefetch: true` 한 줄만 추가하면 기본 기능이 활성화된다. 하지만 여기서 멈추면 아쉽다. Astro는 다양한 프리페칭 전략을 제공하는데, 각각의 특성을 이해하고 우리 블로그에 맞는 전략을 선택하는 것이 중요하다.

가장 기본적인 `hover` 전략은 사용자가 링크 위에 마우스를 올릴 때 해당 페이지를 미리 로드한다. 사용자의 의도를 어느 정도 파악할 수 있어서 효율적이다. `tap` 전략은 모바일에 특화되어 있어서 사용자가 터치하는 순간 프리페치를 시작한다. `viewport` 전략은 링크가 화면에 보이기만 해도 미리 로드하고, `load` 전략은 페이지가 로드되자마자 모든 링크를 프리페치한다.

## 우리 블로그 사용자들의 행동을 관찰하며

블로그를 운영하면서 사용자들이 어떻게 콘텐츠를 소비하는지 생각해봤다. 대부분의 방문자들은 메인 페이지나 포스트 목록에서 제목을 훑어보며 관심있는 글을 찾는다. 그리고 선택적으로 포스트를 클릭해서 읽는다. 또한 한 포스트를 다 읽은 후에는 관련된 다른 포스트나 다음/이전 포스트로 이동하는 경우가 많다.

이런 행동 패턴을 보면서, 모든 링크에 똑같은 프리페칭 전략을 적용하는 것보다는 각 컴포넌트의 역할에 맞는 전략을 선택하는 것이 좋겠다고 생각했다. 무작정 모든 페이지를 미리 로드하면 사용자의 네트워크 데이터만 낭비하고 서버에도 불필요한 부하를 줄 수 있으니까.

특히 모바일 사용자들을 고려하면 더욱 신중해야 한다. 데이터 요금제를 사용하는 사용자들에게 불필요한 트래픽을 발생시키는 것은 좋지 않다. 다행히 Astro는 데이터 절약 모드나 느린 연결 상황을 자동으로 감지해서 프리페칭을 제한하는 기능도 제공한다.

## 컴포넌트별로 전략을 세우며

결국 각 컴포넌트의 특성을 살펴보고 맞춤형 전략을 적용하기로 했다.

블로그 포스트 링크들(`BlogCard.astro`와 `PostListItem.astro`)에는 `hover` 전략을 적용했다. 사용자가 제목에 마우스를 올리는 행동은 그 포스트에 관심이 있다는 신호로 볼 수 있기 때문이다. 모바일에서는 hover가 완벽하지 않지만, 탭 제스처로 어느 정도 동작하기 때문에 괜찮다고 판단했다.

페이지네이션(`Pagination.astro`)에는 `viewport` 전략을 선택했다. 사용자가 페이지 하단까지 스크롤해서 페이지네이션을 볼 수 있다면, 다음 페이지로 넘어갈 가능성이 높다고 봤다. 특히 블로그는 순차적으로 읽는 특성이 있어서, 미리 다음 페이지를 준비해두면 더 부드러운 경험을 제공할 수 있다.

헤더 네비게이션(`Header.astro`)에는 `load` 전략을 적용했다. About 페이지나 다른 주요 섹션들은 사이트 전체에서 접근할 수 있고, 사용자들이 언제든 클릭할 가능성이 있다. 페이지가 로드된 후 백그라운드에서 미리 준비해두면 전체적인 사이트 탐색 경험이 향상된다.

페이지네이션에서는 조금 더 세심하게 접근했다. 첫 번째 페이지에서 "이전" 버튼이나 마지막 페이지에서 "다음" 버튼은 비활성 상태인데, 이런 링크들까지 프리페치할 필요는 없다. 그래서 조건부로 프리페칭을 적용했다.

## 실제로 적용해보며

설정 파일 수정은 정말 간단했다. `astro.config.mjs`에 `prefetch: true` 한 줄만 추가하면 끝이다. 복잡한 고급 설정보다는 기본 기능을 활성화하고, 세부적인 조정은 각 컴포넌트 레벨에서 하는 것이 관리하기 편하다고 생각했다.

각 컴포넌트에서는 `data-astro-prefetch` 속성을 추가하는 것만으로 원하는 전략을 적용할 수 있다. 예를 들어 블로그 포스트 링크에는 `data-astro-prefetch="hover"`를, 페이지네이션에는 `data-astro-prefetch="viewport"`를 추가했다.

코드를 수정하면서 TypeScript 진단 오류들이 나타났지만, 이는 Astro 컴포넌트의 특성상 나타나는 것들이고 실제 동작에는 문제가 없다. Astro는 HTML 속성을 그대로 사용하기 때문에 `class` 속성을 `className`으로 바꿀 필요가 없다.

## 결과를 기대하며

이렇게 프리페칭을 적용하고 나니 사용자들이 블로그를 탐색할 때 훨씬 더 부드러운 경험을 할 수 있을 것 같다. 포스트 제목에 마우스를 올리면 미리 로드가 시작되고, 실제로 클릭했을 때는 거의 즉시 페이지가 나타날 것이다. 페이지네이션도 마찬가지로, 사용자가 페이지 하단에 도달했을 때 이미 다음 페이지가 준비되어 있을 것이다.

물론 모든 브라우저에서 동일하게 동작하지는 않는다. Chrome에서는 완전히 지원되고, Firefox에서는 부분적으로 지원되며, Safari에서는 제한적이다. 하지만 프리페칭은 점진적 향상(Progressive Enhancement)의 좋은 예시다. 지원되는 브라우저에서는 더 나은 경험을 제공하고, 지원되지 않는 브라우저에서도 기존과 동일하게 동작한다.

앞으로는 실제 사용자 데이터를 수집해서 프리페칭이 얼마나 효과적인지 측정해보고 싶다. Core Web Vitals 점수가 개선되는지, 사용자들의 페이지 이동 패턴이 어떻게 변하는지 관찰해볼 계획이다. 필요하다면 전략을 조정하거나 더 정교한 조건부 프리페칭을 적용할 수도 있을 것이다.

결국 기술적인 최적화의 목표는 사용자 경험 개선이다. 프리페칭이라는 작은 기능 하나로도 블로그를 읽는 경험이 한층 더 즐거워질 수 있다면, 그것만으로도 충분히 의미 있는 개선이라고 생각한다.
